<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
	<script type="text/javascript" src="skrollr.min.js"></script>
	<style>
		html {
			background: #111;
		}
		main {
			position: fixed;
		}
		main img {
			position: absolute;
			z-index: 10;
		}
		main svg {
			position: absolute;
		}
		#time {
			z-index: 99;
			color: #eee;
		}

		#protester {
			fill:none; 
			stroke-linecap:round;
			stroke-linejoin:round;
			stroke:#fff600;
			stroke-dasharray:100; 
			stroke-dashoffset:0;
		}

		#police {
			fill:none; 
			stroke-linecap:round;
			stroke-linejoin:round;
			stroke:#408000;
			stroke-dasharray:100; 
			stroke-dashoffset:0;
			z-index:1;
		}

		section {
			position: fixed;
			display: block;
			margin-left: 1040px;
			height: 1024px;
			overflow-y: auto;
			color: #eee;
		}

	</style>
</head>
<body>
	<main>
		<div id="time">15:00</div>
		<img id="map" src="map.svg" width="1024" height="1024">
		<svg>
			<defs><filter id="b10" width="1000%" height="1000%" x="-500%" y="-500%">
				<feGaussianBlur in="SourceGraphic" stdDeviation="10" />
			</filter></defs>
		</svg>
		<!--testing
		<svg width="1024" height="1024" id="偉華中心">
			<path id="protester" pathLength="100" filter="url(#b10)" stroke-width="30" d="M651.5,250.3c0,0,13.3-9.4,13.3-14.9c0-5.5-30.3-6.1-31.9,0c-1.5,6.1,3.7,25.3,3.7,25.3l35.7,6.1l6.3-45.2	l-52.4,3.6l2.6,44.1l55.8,11.1l8.3-80l-74.4,16.8l2.1,57.3l79.4,19.5l6.5-106.7L613,212.3l2,69.7l99.8,26.5l2.2-134"
			data-start="stroke-dashoffset:80" />
			</path>
		</svg>

		<svg width="1024" height="1024" id="偉華中心">
			<path id="police" pathLength="100" filter="url(#b10)" stroke-width="30" d="M731.1,155c0,0-23.3,23.2-40.6,44.1c-17.4,20.9-36.6,44-36.6,44"
			data-start="stroke-dashoffset:50"
			data-3000="stroke-dashoffset:-90" />

			</path>
		</svg>
-->

	</main>
	<section>
		</section>
	<script>
		Papa.parse("https://raw.githubusercontent.com/tobias9412/0714/master/0714route.csv", {
				download: true,
				header: true,
				complete: function(results) {
					routes = results.data;
					console.log(routes);
					for (var i = 0; i < results.data.length-1; i++) {
						$("main").append(
							"<svg width='1024' height='1024' id='" + results.data[i].remark + "'>" + 
							"<path id='" + results.data[i].id + "' pathLength='100' filter='url(#b10)'" +
							"stroke-width='" + results.data[i].w + "'" +
							"d='" + results.data[i].d + "'" + 
							"data-" + (timeOffset(results.data[i].block)-1) + "='display:none'" + 
							"data-" + timeOffset(results.data[i].block) + "='display:block'" + 
							"data-" + timeOffset(results.data[i].t0) + "='stroke-dashoffset:" + results.data[i].s0 + "'" + 
							"data-" + timeOffset(results.data[i].t1) + "='stroke-dashoffset:" + results.data[i].s1 + "'" + 
							"data-" + (timeOffset(results.data[i].none)-1) + "='display:block'" + 
							"data-" + timeOffset(results.data[i].none) + "='display:none'" + 
							"/></svg>"
						);
					}


					var s = skrollr.init();
				}
			});
		
		/*
		Papa.parse("https://raw.githubusercontent.com/tobias9412/0714/master/0714description.csv", {
			download: true,
			header: true,
			complete: function(results) {
				console.log(results.data);
				for (var i = 0; i < results.data.length-1; i++) {
					$("section").append("<p>" + results.data[i].timestamp + " ");
					$("section").append(results.data[i].source + " ");
					$("section").append("<a href='" + results.data[i].webLink + "'>link</a><br>");
					$("section").append("<img src='" + results.data[i].imgLink + "' width='500'><br>");
					$("section").append(results.data[i].description + "</p>");
				}
			}
		});
		*/
		function timeOffset(t) {
			if (t == 0) 
				return (1);
			else
				return ((t-0.625)*24000);
		}

  		$(window).scroll(function () {
			var h = 15+(window.scrollY-window.scrollY%1000)/1000;
			var m = (window.scrollY%1000)/1000*60;
			m = m.toFixed(0).toString();
			if (m == 60) {
				h = h + 1;
				m = "00";
			};
			if (h == 24) h = 0;
			if (m.length == 1) m = "0" + m; 
			$( "#time" ).text(h + ":" + m);
		});


	</script>
</body>
</html>